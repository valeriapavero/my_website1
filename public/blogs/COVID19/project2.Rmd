---
title: "COVID-19 Death Rate Analysis"
output: html_document
---

CDC COVID-19 Public Use Data

[CDC Covid-19 Case Surveillance Data]

```{r, cache=TRUE}
library(tidyverse)  
library(mosaic)
library(ggthemes)
library(lubridate)
library(here)
library(skimr)
library(janitor)
library(httr)
library(readxl)
library(vroom)

url <- "https://data.cdc.gov/api/views/vbim-akqf/rows.csv?accessType=DOWNLOAD"

covid_data <- read_csv(url)%>% 
  # If vroom::vroom(url) doesn't work, use read_csv(url)
  clean_names()

```


```{r covid_challenge, echo=FALSE, out.width="100%"}
knitr::include_graphics(here::here("images", "covid_death_rate_comorbidities.png"), error = FALSE)

knitr::include_graphics(here::here("images", "covid_death_rate_icu.png"), error = FALSE)
```

Death Rate by age group, sex, and whether the patient was admited to Intensive Care Unit (ICU) or not.

```{r, covid_comorbidities}

#By age group, sex, and whether the patient had co-morbidities or not

covid_data_tidy <- covid_data %>% 
  filter(!medcond_yn %in% c("Missing", "Unknown")) %>% 
  filter(!sex %in% c("Missing", "Unknown", "Other", NA)) %>% 
  filter(!age_group %in% c("Missing", "Unknown", "Other")) %>% 
  mutate(death_rate_binary = case_when(death_yn == "Yes" ~ 1, 
                                       TRUE ~ 0)) %>%
  group_by(age_group, sex, medcond_yn) %>% 
  summarise(death_percent = mean(death_rate_binary)*100) %>% 
  ungroup()

```

```{r}
covid_plot_data <- covid_data_tidy %>%  
  mutate(comorbidities = case_when(medcond_yn == "Yes" ~ "With Comorbidities", 
                            TRUE ~ "Without Comorbidities"))

covid_plot <- ggplot(covid_plot_data) +
  geom_bar(aes(death_percent,  age_group), stat = "identity", fill = "#4863A0", alpha = 0.8) + 
  geom_text(aes(death_percent, y = age_group, label = round(death_percent, 1)), hjust = -0.1,  size = 3) + 
  facet_grid(comorbidities ~  sex) +
    labs(
    
    x = "", 
    y = "", 
    title = "Covid death % by age group, sex and presence of co-morbidities"
    
  ) + 
   theme_bw() +
   theme(plot.title = element_text(size=11)) 


covid_plot
```


Death Rate by age group, sex, and whether the patient was admited to Intensive Care Unit (ICU) or not.

```{r}
#by age group, sex, and whether the patient had  admitted to Intensive Care Unit (ICU) or not.

covid_data %>% 
  mutate(death_rate_binary = case_when(death_yn == "Yes" ~ 1, 
                                       TRUE ~ 0)) %>%
  group_by(age_group, sex, icu_yn) %>% 
  summarise(death_percent = mean(death_rate_binary)*100) %>% 
  ungroup() %>% 
  filter(!icu_yn %in% c("Missing", "Unknown")) %>% 
  filter(!sex %in% c("Missing", "Unknown", "Other", NA)) %>% 
  filter(!age_group %in% c("Missing", "Unknown", "Other")) %>% 
  mutate(icu_admitted = case_when(icu_yn == "Yes" ~ "Admitted to ICU", 
                            TRUE ~ "NO ICU")) %>% 
  ggplot() +
  geom_bar(aes(death_percent,  age_group), stat = "identity", fill = "#E77471", alpha = 0.8) + 
  geom_text(aes(death_percent, y = age_group, label = round(death_percent, 1)), hjust = -0.1,  size = 3) + 
  facet_grid(icu_admitted ~  sex) + 
  labs(
    
    x = "", 
    y = "", 
    title = "Covid death % by age group, sex and whether patient was admitted to ICU"
    
  ) + 
   theme_bw() + 
     theme(plot.title = element_text(size=11))
